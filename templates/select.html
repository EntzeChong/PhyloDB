{% extends 'base.html' %}

{% block jquery %}
    <link rel='stylesheet' type='text/css' href="../media/dynatree/ui.dynatree.css">
    <script src="../media/dynatree/jquery.dynatree.js" type="text/javascript"></script>
{% endblock %}

{% block pagetitle %}
    <title>Select</title>
{% endblock %}

{% block dynatree %}
    <script type="text/javascript">
        $(function () {
            $("#tree").dynatree({
                checkbox: true,
                selectMode: 3,

                initAjax: {
                    url: "/getProjectTree/",
                    dataType: "jsonp",
                    data: {}
                },

                onSelect: function () {
                    var selectedNodes = $("#tree").dynatree("getSelectedNodes");
                    selectedKeys = $.map(selectedNodes, function (node) {
                        return node.data.id;
                    });

                    // clear existing input box
                    $('#selected .list input').remove();
                    // add 'hidden' input box for each selectedKeys
                    $.each(selectedKeys, function (index, value) {
                        $('#selected .list').append("<input name=\"list\" type=\"hidden\" value=\"" + value + "\"/>")

                    });

                    //clear meassage
                    $('#selected .list li').remove();
                    $('#selected .list').append("<li>Your selection has been recorded!")
                    $('#selected .list').append("<li>Click submit button to proceed")
                }
            }); // end dynatree
        }); // end original function()
    </script>
{% endblock %}

{% block content %}
    <br>
    <table width="100%" border="2" cellspacing="0" cellpadding="5">
        <tr>
            <th>Select any combination of data for analysis:</th>
        </tr>
        <tr>
            <td width="60%" style="padding-right: 10px; vertical-align: top">
                <div id="tree"></div>
            </td>
        </tr>
    </table>

    <form id="form" method="post" action="{% url 'graph' %}">
        {% csrf_token %}
        <div id="selected">
            <ul class="list">
                <li>No projects/samples are currently selected!
                <input name="list" type="hidden" value="node"/>
            </ul>
        </div>
        <p><input id="submit" type="submit" value="Submit selection"/></p>
    </form>


{% endblock %}

